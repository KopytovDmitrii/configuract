# Спринт 2: Реактивность и компонентная система (3 недели)

## Цели спринта
- Реализовать систему реактивности на основе Proxy API
- Добавить компонентную архитектуру с жизненным циклом
- Реализовать динамическое обновление DOM
- Создать систему директив для условного рендеринга и циклов

## Критерии готовности (Definition of Done)
- [ ] Состояние автоматически обновляет DOM при изменениях
- [ ] Компоненты корректно монтируются и размонтируются
- [ ] Жизненный цикл компонентов работает
- [ ] Директивы v-if и v-for функциональны
- [ ] Производительность: обновление состояния < 16мс
- [ ] Покрытие тестами > 85%

---

## НЕДЕЛЯ 1: Система реактивности

### День 1-3: Proxy-based реактивность
**Задача 2.1: Создание Reactive Proxy**
- [ ] Реализация обработчиков get/set/deleteProperty
- [ ] Отслеживание доступа к свойствам
- [ ] Вложенная реактивность для объектов и массивов
- [ ] Поддержка примитивных типов

**Время**: 18 часов  
**Ответственный**: Разработчик  
**Критерии**: Изменения в объекте отслеживаются

```typescript
// Пример API
const state = createReactive({
  user: { name: "Иван", age: 25 },
  items: [1, 2, 3]
});

// Любые изменения должны отслеживаться
state.user.name = "Петр"; // Триггер
state.items.push(4);      // Триггер
```

**Задача 2.2: Система подписок (Observers)**
- [ ] Реестр наблюдателей для каждого свойства
- [ ] Подписка компонентов на изменения
- [ ] Автоматическая отписка при размонтировании
- [ ] Оптимизация: избегание дублирования подписок

**Время**: 12 часов  
**Ответственный**: Разработчик  
**Критерии**: Компоненты получают уведомления об изменениях

### День 4-5: Dependency Tracking
**Задача 2.3: Сбор зависимостей при рендеринге**
- [ ] Трекинг доступа к reactive свойствам во время render
- [ ] Связывание компонентов с используемыми свойствами
- [ ] Глобальный стек эффектов
- [ ] Очистка зависимостей перед повторным рендером

**Время**: 15 часов  
**Ответственный**: Разработчик  
**Критерии**: Компоненты обновляются только при изменении используемых данных

**Задача 2.4: Update Queue и батчинг**
- [ ] Очередь обновлений для предотвращения избыточных рендеров
- [ ] Асинхронный батчинг через requestAnimationFrame
- [ ] Приоритизация обновлений
- [ ] Предотвращение циклических обновлений

**Время**: 10 часов  
**Ответственный**: Разработчик  
**Критерии**: Множественные изменения обрабатываются в одном цикле

---

## НЕДЕЛЯ 2: Компонентная система

### День 6-8: Component Registry и жизненный цикл
**Задача 2.5: Система регистрации компонентов**
- [ ] Реестр компонентов по имени
- [ ] Валидация определений компонентов
- [ ] API для регистрации и получения компонентов
- [ ] Поддержка переопределения компонентов

**Время**: 12 часов  
**Ответственный**: Разработчик  
**Критерии**: Компоненты можно регистрировать и использовать

```typescript
// Пример API
Framework.registerComponent('Button', {
  props: ['text', 'variant'],
  render(props) {
    return {
      tag: 'button',
      props: { class: `btn btn-${props.variant}` },
      children: [props.text]
    };
  }
});
```

**Задача 2.6: Жизненный цикл компонентов**
- [ ] Хуки onCreate, onMount, onUpdate, onDestroy
- [ ] Правильная последовательность вызовов
- [ ] Передача контекста в хуки
- [ ] Обработка ошибок в хуках

**Время**: 15 часов  
**Ответственный**: Разработчик  
**Критерии**: Все хуки вызываются в правильном порядке

### День 9-10: Props и State изоляция
**Задача 2.7: Управление props компонентов**
- [ ] Передача свойств из родительского конфига
- [ ] Валидация типов props
- [ ] Значения по умолчанию
- [ ] Реактивность props

**Время**: 10 часов  
**Ответственный**: Разработчик  
**Критерии**: Props корректно передаются и валидируются

**Задача 2.8: Изолированное состояние компонентов**
- [ ] Каждый экземпляр компонента имеет свое состояние
- [ ] Реактивность локального состояния
- [ ] Очистка состояния при размонтировании
- [ ] API для работы с состоянием компонента

**Время**: 12 часов  
**Ответственный**: Разработчик  
**Критерии**: Компоненты независимы друг от друга

---

## НЕДЕЛЯ 3: Динамические обновления и директивы

### День 11-13: DOM diffing и обновления
**Задача 2.9: Алгоритм сравнения конфигураций**
- [ ] Сравнение старой и новой конфигурации
- [ ] Определение минимального набора изменений
- [ ] Поддержка key для оптимизации списков
- [ ] Обработка добавления/удаления элементов

**Время**: 18 часов  
**Ответственный**: Разработчик  
**Критерии**: Изменяются только затронутые DOM элементы

**Задача 2.10: Эффективные DOM обновления**
- [ ] Патчинг существующих элементов
- [ ] Сохранение состояния форм
- [ ] Сохранение focus и selection
- [ ] Анимации переходов

**Время**: 12 часов  
**Ответственный**: Разработчик  
**Критерии**: UX остается плавным при обновлениях

### День 14-15: Template директивы
**Задача 2.11: Условный рендеринг (v-if)**
- [ ] Парсинг условных выражений в конфигурации
- [ ] Динамическое добавление/удаление элементов
- [ ] Поддержка v-else-if и v-else
- [ ] Оптимизация: кеширование неактивных веток

**Время**: 10 часов  
**Ответственный**: Разработчик  
**Критерии**: Элементы показываются/скрываются по условию

```json
{
  "tag": "div",
  "if": "user.isLoggedIn",
  "children": ["Добро пожаловать!"]
}
```

**Задача 2.12: Рендеринг списков (v-for)**
- [ ] Итерация по массивам и объектам
- [ ] Поддержка синтаксиса "item in items"
- [ ] Ключи для оптимизации
- [ ] Реактивные обновления списков

**Время**: 12 часов  
**Ответственный**: Разработчик  
**Критерии**: Списки обновляются при изменении данных

```json
{
  "for": "item in items",
  "key": "item.id",
  "template": {
    "tag": "li",
    "children": ["{{item.name}}"]
  }
}
```

### День 16-18: Привязка данных и оптимизации
**Задача 2.13: Интерполяция данных {{}**
- [ ] Парсинг выражений в строках
- [ ] Безопасная оценка выражений
- [ ] Реактивные обновления интерполяций
- [ ] Поддержка простых вычислений

**Время**: 12 часов  
**Ответственный**: Разработчик  
**Критерии**: Данные отображаются и обновляются в шаблонах

**Задача 2.14: Оптимизации производительности**
- [ ] Мемоизация результатов рендеринга
- [ ] Debouncing частых обновлений
- [ ] Lazy loading неиспользуемых компонентов
- [ ] Профилирование и метрики

**Время**: 15 часов  
**Ответственный**: Разработчик  
**Критерии**: Производительность соответствует целевым метрикам

### День 19-21: Тестирование и интеграция
**Задача 2.15: Комплексное тестирование**
- [ ] Unit тесты для реактивной системы
- [ ] Unit тесты для компонентов
- [ ] Интеграционные тесты обновлений
- [ ] Performance тесты

**Время**: 18 hours  
**Ответственный**: Разработчик  
**Критерии**: >85% покрытие, все тесты проходят

---

## Структура проекта после Спринта 2

```
src/
├── core/
│   ├── reactive.ts       # Proxy-based реактивность
│   ├── component.ts      # Компонентная система
│   ├── renderer.ts       # Обновленный рендерер
│   └── scheduler.ts      # Update queue
├── directives/
│   ├── if.ts            # Условный рендеринг
│   ├── for.ts           # Циклы
│   └── model.ts         # Двусторонняя привязка
├── utils/
│   ├── diff.ts          # DOM diffing
│   └── expression.ts    # Парсер выражений
└── __tests__/
    ├── reactive.test.ts
    ├── component.test.ts
    ├── directives.test.ts
    └── integration.test.ts
```

## Метрики успеха
- **Реактивность**: Обновление < 16ms для 1000 элементов
- **Память**: Нет утечек при монтировании/размонтировании
- **Компоненты**: Поддержка 10+ вложенных уровней
- **Директивы**: Все основные директивы работают
- **Тесты**: >85% покрытие кода

## Риски и митигация
- **Риск**: Сложность Proxy API
  - **Митигация**: Изучение примеров Vue 3, фоллбек на Object.defineProperty
- **Риск**: Производительность реактивности
  - **Митигация**: Профилирование, оптимизация горячих путей
- **Риск**: Циклические зависимости
  - **Митигация**: Детекция циклов, лимиты на глубину

## Результат спринта
**Полнофункциональный реактивный фреймворк** с:
- Автоматическими обновлениями DOM при изменении данных
- Компонентной архитектурой с жизненным циклом
- Базовыми директивами для условного рендеринга и циклов
- Оптимизированными обновлениями DOM
- Готовностью для создания сложных приложений

Результат готов для финальной полировки и продвинутых возможностей в Спринте 3.