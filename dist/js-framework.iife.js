var JSFramework=function(e){"use strict";class t{constructor(){this.validHtmlTags=new Set(["div","span","p","h1","h2","h3","h4","h5","h6","button","input","form","label","textarea","select","option","a","img","ul","ol","li","table","tr","td","th","header","footer","main","section","article","nav","strong","em","small","br","hr"]),this.usedIds=new Set}reset(){this.usedIds.clear()}validate(e,t=""){const n=[];return e&&"object"==typeof e?(this.validateTag(e,n,t),e.props&&this.validateProps(e.props,n,t),e.children&&this.validateChildren(e.children,n,t),e.events&&this.validateEvents(e.events,n,t),{isValid:0===n.length,errors:n}):(n.push({field:"config",message:"Конфигурация должна быть объектом",path:t}),{isValid:!1,errors:n})}validateTag(e,t,n){e.component?"string"!=typeof e.component&&t.push({field:"component",message:"Имя компонента должно быть строкой",path:n}):e.tag?"string"==typeof e.tag?this.validHtmlTags.has(e.tag.toLowerCase())||t.push({field:"tag",message:`Неподдерживаемый HTML тег: ${e.tag}`,path:n}):t.push({field:"tag",message:"Поле tag должно быть строкой",path:n}):t.push({field:"tag",message:"Поле tag является обязательным для элементов (или укажите component для компонентов)",path:n})}validateProps(e,t,n){"object"==typeof e&&null!==e?(void 0!==e.class&&"string"!=typeof e.class&&t.push({field:"props.class",message:"Класс должен быть строкой",path:n}),void 0!==e.id&&("string"!=typeof e.id?t.push({field:"props.id",message:"ID должен быть строкой",path:n}):this.usedIds.has(e.id)?t.push({field:"props.id",message:`Дублирующийся ID: ${e.id}`,path:n}):this.usedIds.add(e.id)),void 0!==e.style&&("object"!=typeof e.style||null===e.style?t.push({field:"props.style",message:"Стили должны быть объектом",path:n}):this.validateStyles(e.style,t,n))):t.push({field:"props",message:"Свойства должны быть объектом",path:n})}validateStyles(e,t,n){for(const[s,r]of Object.entries(e))"string"!=typeof r&&"number"!=typeof r&&t.push({field:`props.style.${s}`,message:"Значение стиля должно быть строкой или числом, получено: "+typeof r,path:n})}validateChildren(e,t,n){Array.isArray(e)?e.forEach((e,s)=>{const r=n?`${n}.children[${s}]`:`children[${s}]`;if("string"!=typeof e)if("object"==typeof e&&null!==e){const n=this.validate(e,r);t.push(...n.errors)}else t.push({field:"children",message:"Дочерний элемент должен быть строкой или объектом конфигурации, получено: "+typeof e,path:r})}):t.push({field:"children",message:"Дочерние элементы должны быть массивом",path:n})}validateEvents(e,t,n){if("object"==typeof e&&null!==e)for(const[s,r]of Object.entries(e))"function"!=typeof r&&t.push({field:`events.${s}`,message:"Обработчик события должен быть функцией, получено: "+typeof r,path:n}),this.isValidEventType(s)||t.push({field:`events.${s}`,message:`Неподдерживаемый тип события: ${s}`,path:n});else t.push({field:"events",message:"События должны быть объектом",path:n})}isValidEventType(e){return["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","mouseenter","mouseleave","keydown","keyup","keypress","focus","blur","change","input","submit","reset","load","unload","resize","scroll","touchstart","touchend","touchmove","touchcancel"].includes(e)||["mounted","unmounted"].includes(e)}getSupportedTags(){return Array.from(this.validHtmlTags)}addSupportedTag(e){this.validHtmlTags.add(e.toLowerCase())}removeSupportedTag(e){this.validHtmlTags.delete(e.toLowerCase())}}let n;const s=[],r=new WeakMap,o=new WeakMap,i=new WeakMap;function a(e,t={}){if(o.has(e))return o.get(e);const s=new Proxy(e,{get(s,o,i){!function(e,t){if(!n||!l)return;let s=r.get(e);s||r.set(e,s=new Map);let o=s.get(t);o||s.set(t,o={key:String(t),effects:new Set});o.effects.add(n),n.deps.add(o)}(e,o);const c=Reflect.get(s,o,i);return!1!==t.deep&&"object"==typeof c&&null!==c?a(c,t):(t.debuggerOptions?.onTrack&&t.debuggerOptions.onTrack({type:"get",target:s,key:o,newValue:c}),c)},set(n,s,r,o){const i=n[s],a=Object.prototype.hasOwnProperty.call(n,s),l=Reflect.set(n,s,r,o);return a?i!==r&&c(e,s,"set"):c(e,s,"add"),t.debuggerOptions?.onTrigger&&t.debuggerOptions.onTrigger({type:a?"set":"add",target:n,key:s,newValue:r,oldValue:i}),l},deleteProperty(n,s){const r=Object.prototype.hasOwnProperty.call(n,s),o=n[s],i=Reflect.deleteProperty(n,s);return i&&r&&(c(e,s,"delete"),t.debuggerOptions?.onTrigger&&t.debuggerOptions.onTrigger({type:"delete",target:n,key:s,oldValue:o})),i}});return o.set(e,s),i.set(s,e),s}function c(e,t,s,o,i){const a=r.get(e);if(!a)return;const c=new Set,l=a.get(t);if(l&&l.effects.forEach(e=>{e!==n&&c.add(e)}),("add"===s||"delete"===s)&&Array.isArray(e)){const e=a.get("length");e&&e.effects.forEach(e=>{e!==n&&c.add(e)})}c.forEach(e=>{e.options?.scheduler?e.options.scheduler(e):e.fn()})}let l=!0;function h(e,t={}){const r={fn:e,active:!0,deps:new Set,options:t};return t.lazy||function(e){if(!e.active)return e.fn();u(e);try{return s.push(e),n=e,e.fn()}finally{s.pop(),n=s[s.length-1]}}(r),r}function u(e){e.deps.forEach(t=>{t.effects.delete(e)}),e.deps.clear()}function p(e){e.active&&(u(e),e.active=!1)}const d=new class{constructor(){this.components=new Map,this.instances=new Map,this.instanceCounter=0}register(e){if(!e.name)throw new Error("Компонент должен иметь имя");this.components.has(e.name)&&console.warn(`Компонент "${e.name}" уже зарегистрирован. Перезаписываем.`),this.validateComponent(e),this.components.set(e.name,e)}get(e){return this.components.get(e)}has(e){return this.components.has(e)}unregister(e){const t=Array.from(this.instances.values()).filter(t=>t.component.name===e&&t.mounted);return t.length>0?(console.warn(`Попытка удаления компонента "${e}" с ${t.length} активными экземплярами`),!1):this.components.delete(e)}createInstance(e,t={}){const n=this.get(e);if(!n)throw new Error(`Компонент "${e}" не найден`);const s=this.generateInstanceId(),r=this.validateAndNormalizeProps(t,n.props);try{n.beforeCreate?.()}catch(l){console.error(`Ошибка в хуке beforeCreate компонента "${e}":`,l)}const o=a(n.state?n.state():{}),i={};if(n.computed)for(const[a,h]of Object.entries(n.computed))try{Object.defineProperty(i,a,{get:()=>h.call({state:o,props:r,computed:i}),enumerable:!0,configurable:!0})}catch(l){console.warn(`Ошибка при создании computed свойства "${a}":`,l),i[a]=void 0}const c={id:s,component:n,props:r,state:o,computed:i,element:null,mounted:!1,dependencies:new Set,children:[],parent:null,pluginContext:{},cleanup:[]};this.instances.set(s,c);try{n.created?.call(c)}catch(l){console.error(`Ошибка в хуке created компонента "${e}":`,l)}return c}getInstance(e){return this.instances.get(e)}destroyInstance(e){const t=this.instances.get(e);if(!t)return!1;t.mounted&&t.element&&this.unmountInstance(t);try{t.component.destroyed?.call(t)}catch(n){console.error(`Ошибка в хуке destroyed компонента "${t.component.name}":`,n)}return t.dependencies.clear(),t.children.forEach(e=>{e.parent=null}),this.instances.delete(e)}mountInstance(e,t){if(e.mounted)console.warn(`Экземпляр ${e.id} уже смонтирован`);else{try{e.component.beforeMount?.call(e)}catch(n){console.error(`Ошибка в хуке beforeMount компонента "${e.component.name}":`,n)}e.element=t,e.mounted=!0;try{e.component.mounted?.call(e)}catch(n){console.error(`Ошибка в хуке mounted компонента "${e.component.name}":`,n)}}}unmountInstance(e){if(e.mounted){try{e.component.beforeDestroy?.call(e)}catch(t){console.error(`Ошибка в хуке beforeDestroy компонента "${e.component.name}":`,t)}e.children.forEach(e=>{this.unmountInstance(e)}),e.cleanup.forEach(e=>{try{e()}catch(t){console.error("Ошибка при очистке ресурсов:",t)}}),e.element=null,e.mounted=!1;try{e.component.destroyed?.call(e)}catch(t){console.error(`Ошибка в хуке destroyed компонента "${e.component.name}":`,t)}}}updateInstanceProps(e,t){const n=e.component,s=this.validateAndNormalizeProps(t,n.props),r=[];for(const i in s)e.props[i]!==s[i]&&r.push(i);if(0!==r.length){try{n.beforeUpdate?.call(e,r,[])}catch(o){console.error(`Ошибка в хуке beforeUpdate компонента "${n.name}":`,o)}e.props=s;try{n.updated?.call(e,r,[])}catch(o){console.error(`Ошибка в хуке updated компонента "${n.name}":`,o)}}}getInstancesByComponent(e){return Array.from(this.instances.values()).filter(t=>t.component.name===e)}getMountedInstances(){return Array.from(this.instances.values()).filter(e=>e.mounted)}clearInstances(){Array.from(this.instances.values()).forEach(e=>{this.destroyInstance(e.id)})}clear(){this.clearInstances(),this.components.clear()}getRegisteredComponents(){return Array.from(this.components.keys())}getStats(){const e=this.getMountedInstances().length;return{registeredComponents:this.components.size,totalInstances:this.instances.size,mountedInstances:e,unmountedInstances:this.instances.size-e}}validateComponent(e){if("function"!=typeof e.render)throw new Error(`Компонент "${e.name}" должен иметь функцию render`);if(e.props)for(const[t,n]of Object.entries(e.props))if(!this.isValidPropDefinition(n))throw new Error(`Некорректное определение свойства "${t}" в компоненте "${e.name}"`)}isValidPropDefinition(e){return["string","number","boolean","object","array","function"].includes(e.type)}validateAndNormalizeProps(e,t){if(!t)return e||{};const n={};for(const[s,r]of Object.entries(t)){const t=e[s];if(r.required&&null==t)throw new Error(`Обязательное свойство "${s}" не передано`);if(void 0!==t){if(!this.validatePropType(t,r.type))throw new Error(`Свойство "${s}" должно быть типа ${r.type}, получено ${typeof t}`);if(r.validator&&!r.validator(t))throw new Error(`Свойство "${s}" не прошло кастомную валидацию`);n[s]=t}else n[s]=r.default}return n}validatePropType(e,t){switch(t){case"string":return"string"==typeof e;case"number":return"number"==typeof e&&!isNaN(e);case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"object":return null!==e&&"object"==typeof e&&!Array.isArray(e);case"array":return Array.isArray(e);default:return!1}}generateInstanceId(){return`component_${++this.instanceCounter}_${Date.now()}`}};function f(e){d.register(e)}const m=new class{constructor(){this.updateQueue=new Set,this.isFlushPending=!1,this.isFlushActive=!1,this.currentFlushPromise=null}schedule(e){const t="function"==typeof e?e:e.fn;this.updateQueue.add(t),this.isFlushPending||this.isFlushActive||(this.isFlushPending=!0,this.currentFlushPromise=this.scheduleFlush())}scheduleUpdate(e){this.schedule(e)}scheduleFlush(){return new Promise(e=>{requestAnimationFrame(()=>{this.flushUpdates(),e()})})}flushUpdates(){if(!this.isFlushActive){this.isFlushActive=!0,this.isFlushPending=!1;try{const t=Array.from(this.updateQueue);this.updateQueue.clear();for(const n of t)try{n()}catch(e){console.error("Ошибка при выполнении запланированного эффекта:",e)}this.updateQueue.size>0&&!this.isFlushPending&&(this.isFlushPending=!0,this.currentFlushPromise=this.scheduleFlush())}finally{this.isFlushActive=!1,0===this.updateQueue.size&&(this.currentFlushPromise=null)}}}async nextTick(){this.currentFlushPromise&&await this.currentFlushPromise,this.currentFlushPromise&&await this.nextTick()}flushSync(){this.updateQueue.size>0&&this.flushUpdates()}clear(){this.updateQueue.clear(),this.isFlushPending=!1,this.isFlushActive=!1,this.currentFlushPromise=null}getQueueSize(){return this.updateQueue.size}isActive(){return this.isFlushActive||this.isFlushPending}};function g(e){if(!e)return m.nextTick();m.nextTick().then(e)}function y(){m.flushSync()}function v(e){m.schedule(e)}class w{constructor(){this.highPriorityQueue=[],this.normalPriorityQueue=[],this.lowPriorityQueue=[],this.isFlushPending=!1}schedule(e,t="normal"){switch(t){case"high":this.highPriorityQueue.push(e);break;case"low":this.lowPriorityQueue.push(e);break;default:this.normalPriorityQueue.push(e)}this.isFlushPending||(this.isFlushPending=!0,requestAnimationFrame(()=>this.flush()))}flush(){this.isFlushPending=!1,this.executeQueue(this.highPriorityQueue),this.executeQueue(this.normalPriorityQueue),this.executeQueueWithTimeSlicing(this.lowPriorityQueue)}executeQueue(e){for(;e.length>0;){const n=e.shift();try{n()}catch(t){console.error("Ошибка при выполнении задачи:",t)}}}executeQueueWithTimeSlicing(e){const t=performance.now();for(;e.length>0&&performance.now()-t<5;){const t=e.shift();try{t()}catch(n){console.error("Ошибка при выполнении задачи:",n)}}e.length>0&&!this.isFlushPending&&(this.isFlushPending=!0,requestAnimationFrame(()=>this.flush()))}}const b=Object.freeze(Object.defineProperty({__proto__:null,PriorityScheduler:w,flushSync:y,nextTick:g,scheduleUpdate:v,scheduler:m},Symbol.toStringTag,{value:"Module"}));class E{}class P extends E{constructor(){super(...arguments),this.name="if"}process(e,t){if(!e.if)return e;if(this.evaluateExpression(e.if,t)){const{if:t,...n}=e;return n}return null}evaluateExpression(e,t){try{const n=new Function("state","props",`\n        with(state) {\n          with(props) {\n            return ${e};\n          }\n        }\n      `);return Boolean(n(t.state,t.props))}catch(n){return console.warn("Ошибка в выражении v-if:",e,n),!1}}}class C extends E{constructor(){super(...arguments),this.name="for"}process(e,t){if(!e.for||!e.template)return[e];const{items:n,itemName:s,indexName:r}=this.parseForExpression(e.for),o=this.evaluateExpression(n,t);return Array.isArray(o)?o.map((n,o)=>{const i={...t,state:{...t.state,[s]:n,...r?{[r]:o}:{[`${s}Index`]:o}}};return{...this.processTemplate(e.template,i),key:e.key?this.evaluateExpression(String(e.key),i):o}}):(console.warn("v-for требует массив:",n),[])}parseForExpression(e){const t=e.match(/\((\w+),\s*(\w+)\)\s+in\s+(.+)/);if(t)return{itemName:t[1],indexName:t[2],items:t[3]};const n=e.match(/(\w+)\s+in\s+(.+)/);if(n)return{itemName:n[1],items:n[2]};throw new Error(`Неверный синтаксис v-for: "${e}". Используйте: "item in items" или "(item, index) in items"`)}processTemplate(e,t){const n=JSON.parse(JSON.stringify(e));return n.children&&(n.children=n.children.map(e=>"string"==typeof e?this.interpolateString(e,t):this.processTemplate(e,t))),n.props&&Object.keys(n.props).forEach(e=>{const s=n.props[e];"string"==typeof s&&(n.props[e]=this.interpolateString(s,t))}),n}interpolateString(e,t){return e.replace(/\{\{(.+?)\}\}/g,(e,n)=>{try{const e=this.evaluateExpression(n.trim(),t);return String(e)}catch(s){return console.warn("Ошибка в интерполяции:",n,s),e}})}evaluateExpression(e,t){try{return new Function("state","props",`\n        with(state) {\n          with(props) {\n            return ${e};\n          }\n        }\n      `)(t.state,t.props)}catch(n){return console.warn("Ошибка в выражении v-for:",e,n),null}}}class x extends E{constructor(){super(...arguments),this.name="show"}process(e,t){if(void 0===e.show)return e;const n="boolean"==typeof e.show?e.show:this.evaluateExpression(String(e.show),t),s={...e};s.props||(s.props={}),s.props.style||(s.props.style={}),"object"==typeof s.props.style&&(s.props.style.display=n?"":"none");const{show:r,...o}=s;return o}evaluateExpression(e,t){try{const n=new Function("state","props",`\n        with(state) {\n          with(props) {\n            return ${e};\n          }\n        }\n      `);return Boolean(n(t.state,t.props))}catch(n){return console.warn("Ошибка в выражении v-show:",e,n),!1}}}const S=class e extends E{constructor(){super(...arguments),this.name="model"}process(t,n){if(!t.model)return t;const s={...t};s.props||(s.props={}),s.events||(s.events={});const r=t.tag?.toLowerCase();switch(r){case"input":this.handleInputModel(s,n);break;case"textarea":this.handleTextareaModel(s,n);break;case"select":this.handleSelectModel(s,n);break;default:console.warn(`v-model не поддерживается для элемента ${r}`)}const o=s.events?.mounted;s.events=s.events||{},s.events.mounted=s=>{e.modelBindings.set(s,{path:t.model,context:n}),o&&o(s)};const{model:i,...a}=s;return a}handleInputModel(e,t){const n=e.model,s=this.getPropertyValue(n,t);switch(e.props?.type||"text"){case"checkbox":e.props.checked=s,e.events.change=e=>{const s=e.target;this.setPropertyValue(n,s.checked,t)};break;case"radio":e.props.checked=s===e.props?.value,e.events.change=e=>{const s=e.target;s.checked&&this.setPropertyValue(n,s.value,t)};break;default:e.props.value=s,e.events.input=e=>{const s=e.target;this.setPropertyValue(n,s.value,t)}}}handleTextareaModel(e,t){const n=e.model,s=this.getPropertyValue(n,t);e.props.value=s,e.events.input=e=>{const s=e.target;this.setPropertyValue(n,s.value,t)}}handleSelectModel(e,t){const n=e.model,s=this.getPropertyValue(n,t);e.props.value=s,e.events.change=e=>{const s=e.target;this.setPropertyValue(n,s.value,t)}}getPropertyValue(e,t){try{return new Function("state","props",`\n        with(state) {\n          with(props) {\n            return ${e};\n          }\n        }\n      `)(t.state,t.props)}catch(n){return console.warn("Ошибка при получении значения v-model:",e,n),""}}setPropertyValue(e,t,n){try{const s=this.parsePath(e);let r=n.state;for(let e=0;e<s.length-1;e++){const t=s[e];("property"===t.type||"index"===t.type)&&(r=r[t.key])}const o=s[s.length-1];("property"===o.type||"index"===o.type)&&(r[o.key]=t),this.triggerUpdate(n)}catch(s){console.warn("Ошибка при установке значения v-model:",e,s)}}parsePath(e){const t=[],n=e.split(".");for(const s of n){const e=s.match(/^(\w+)\[(\d+)\]$/);e?(t.push({type:"property",key:e[1]}),t.push({type:"index",key:parseInt(e[2])})):t.push({type:"property",key:s})}return t}triggerUpdate(e){Promise.resolve().then(()=>b).then(({scheduler:e})=>{e.scheduleUpdate(()=>{})}).catch(e=>{console.warn("Ошибка при запуске обновления:",e)})}static updateBoundElements(){for(const[n,s]of e.modelBindings)try{const t=(new e).getPropertyValue(s.path,s.context);n instanceof HTMLInputElement?"checkbox"===n.type||"radio"===n.type?n.checked="checkbox"===n.type?t:t===n.value:n.value=String(t||""):(n instanceof HTMLTextAreaElement||n instanceof HTMLSelectElement)&&(n.value=String(t||""))}catch(t){console.warn("Ошибка при обновлении привязанного элемента:",t)}}};S.modelBindings=new Map;let M=S;const T=new class{constructor(){this.directives=new Map,this.register(new P),this.register(new C),this.register(new x),this.register(new M)}register(e){this.directives.set(e.name,e)}processDirectives(e,t){let n=[e];const s=["if","for","show","model"];for(const r of s){const e=this.directives.get(r);if(!e)continue;const s=[];for(const r of n){const n=e.process(r,t);n&&(Array.isArray(n)?s.push(...n):s.push(n))}n=s}return n}hasDirectives(e){return!!(e.if||e.for||void 0!==e.show||e.model)}};class k{constructor(){this.mountedInstances=new Map,this.instanceElements=new Map,this.stats={elementsCreated:0,eventsAttached:0,renderTime:0}}render(e,t){const n=performance.now();try{this.clearContainer(t);const s=this.renderConfig(e);return t.appendChild(s),this.stats.renderTime=performance.now()-n,s}catch(s){throw console.error("Ошибка рендеринга:",s),s}}renderConfig(e,t){return e.component?this.renderComponent(e,t):this.renderElement(e,t)}renderComponent(e,t){const n=e.component,s=d.createInstance(n,e.props);t&&(s.parent=t,t.children.push(s));const r={state:s.state,props:s.props,instance:s,computed:s.computed};return h(()=>{try{const e=s.component.render(s.props,s.state,s.computed),t=T.processDirectives(e,r);if(0===t.length)return void(s.element&&this.unmountComponent(s));const n=this.renderElement(t[0],s);s.element?(s.element.parentNode&&s.element.parentNode.replaceChild(n,s.element),s.element=n):(s.element=n,this.instanceElements.set(s.id,n),this.mountedInstances.set(n,s),d.mountInstance(s,n))}catch(e){console.error("Ошибка при рендеринге компонента:",e)}},{scheduler:e=>m.schedule(e)}),s.element||this.createPlaceholder()}renderElement(e,t){const n={state:t?.state||{},props:t?.props||{},instance:t||void 0,computed:t?.computed||{}},s=T.processDirectives(e,n);if(0===s.length)return this.createPlaceholder();const r=s[0],o=document.createElement(r.tag||"div");return this.stats.elementsCreated++,r.props&&this.applyProps(o,r.props),r.events&&this.attachEvents(o,r.events),r.children&&this.renderChildren(o,r.children,t),o}renderChildren(e,t,n){t.forEach(t=>{if("string"==typeof t){const n=document.createTextNode(t);e.appendChild(n)}else if(t&&"object"==typeof t){const s=this.renderConfig(t,n);e.appendChild(s)}})}applyProps(e,t){for(const[n,s]of Object.entries(t))switch(n){case"class":e.className=s;break;case"id":e.id=s;break;case"style":this.applyStyles(e,s);break;default:null!=s&&e.setAttribute(n,String(s))}}applyStyles(e,t){if("object"==typeof t){for(const[n,s]of Object.entries(t))if(null!=s){const t=n.replace(/([A-Z])/g,"-$1").toLowerCase();e.style.setProperty(t,String(s))}}else"string"==typeof t&&(e.style.cssText=t)}attachEvents(e,t){for(const[n,s]of Object.entries(t))s&&("mounted"!==n&&"unmounted"!==n?(e.addEventListener(n,s),this.stats.eventsAttached++):"mounted"===n&&s(e))}unmountComponent(e){e.element&&(e.element.parentNode&&e.element.parentNode.removeChild(e.element),this.mountedInstances.delete(e.element),this.instanceElements.delete(e.id),d.unmountInstance(e))}createPlaceholder(){const e=document.createElement("span");return e.style.display="none",e.setAttribute("data-placeholder","true"),e}clearContainer(e){Array.from(this.mountedInstances.entries()).filter(([t])=>e.contains(t)).map(([,e])=>e).forEach(e=>{d.destroyInstance(e.id)}),e.innerHTML=""}updateElement(e,t){const n=this.mountedInstances.get(e);if(n)return t.props&&d.updateInstanceProps(n,t.props),n.element||e;{const n=this.renderConfig(t);return e.parentNode&&e.parentNode.replaceChild(n,e),n}}unmount(e){const t=this.mountedInstances.get(e);t?d.destroyInstance(t.id):e.parentNode&&e.parentNode.removeChild(e)}getComponentInstance(e){return this.mountedInstances.get(e)}getStats(){return{...this.stats}}cleanup(){this.mountedInstances.forEach(e=>{d.destroyInstance(e.id)}),this.mountedInstances.clear(),this.instanceElements.clear(),this.stats={elementsCreated:0,eventsAttached:0,renderTime:0}}forceUpdate(){m.flushSync()}findElementById(e,t){return e.querySelector(`#${t}`)}findElementsByClass(e,t){return Array.from(e.querySelectorAll(`.${t}`))}}class ${constructor(e,t){this._dirty=!0,this._setter=t,this._effect=h(()=>e(),{lazy:!0,scheduler:()=>{this._dirty||(this._dirty=!0,this.triggerUpdate())}})}get value(){var e;return this._dirty&&(this._value=((e=this._effect).active,e.fn()),this._dirty=!1),this._value}set value(e){this._setter?this._setter(e):console.warn("Computed свойство доступно только для чтения")}get dirty(){return this._dirty}get effect(){return this._effect}invalidate(){this._dirty=!0,this.triggerUpdate()}triggerUpdate(){m.scheduleUpdate(()=>{})}stop(){p(this._effect)}}function I(e){let t,n;return"function"==typeof e?t=e:(t=e.get,n=e.set),new $(t,n)}const A=new class{constructor(){this.computedRefs=new Set}register(e){this.computedRefs.add(e)}unregister(e){this.computedRefs.delete(e),e.stop()}invalidateAll(){for(const e of this.computedRefs)e.invalidate()}getStats(){let e=0,t=0;for(const n of this.computedRefs)n.dirty?e++:t++;return{total:this.computedRefs.size,dirty:e,clean:t}}cleanup(){for(const e of this.computedRefs)e.stop();this.computedRefs.clear()}};class j{constructor(e){this.plugins=new Map,this.installedPlugins=new Set,this.globalProperties=new Map,this.customDirectives=new Map,this.frameworkInstance=e}use(e,t){if(this.installedPlugins.has(e.name))return console.warn(`Плагин "${e.name}" уже установлен`),this;if(e.dependencies)for(const r of e.dependencies)if(!this.installedPlugins.has(r))throw new Error(`Плагин "${e.name}" требует зависимость "${r}"`);const n={framework:this.frameworkInstance,options:t||{},globalProperties:Object.fromEntries(this.globalProperties),directives:this.customDirectives};try{e.install(this.frameworkInstance,n),this.plugins.set(e.name,e),this.installedPlugins.add(e.name),console.log(`Плагин "${e.name}" успешно установлен`)}catch(s){throw console.error(`Ошибка при установке плагина "${e.name}":`,s),s}return this}uninstall(e){if(!this.installedPlugins.has(e))return console.warn(`Плагин "${e}" не установлен`),!1;const t=this.plugins.get(e);if(t&&"function"==typeof t.uninstall)try{return t.uninstall(this.frameworkInstance),this.plugins.delete(e),this.installedPlugins.delete(e),console.log(`Плагин "${e}" удален`),!0}catch(n){return console.error(`Ошибка при удалении плагина "${e}":`,n),!1}return console.warn(`Плагин "${e}" не поддерживает удаление`),!1}hasPlugin(e){return this.installedPlugins.has(e)}getInstalledPlugins(){return Array.from(this.installedPlugins)}addGlobalProperty(e,t){this.globalProperties.set(e,t)}getGlobalProperty(e){return this.globalProperties.get(e)}registerDirective(e){this.customDirectives.has(e.name)?console.warn(`Директива "${e.name}" уже зарегистрирована`):(this.customDirectives.set(e.name,e),console.log(`Директива "${e.name}" зарегистрирована`))}getDirective(e){return this.customDirectives.get(e)}getAllDirectives(){return new Map(this.customDirectives)}cleanup(){for(const e of this.installedPlugins)this.uninstall(e);this.plugins.clear(),this.installedPlugins.clear(),this.globalProperties.clear(),this.customDirectives.clear()}}function O(e){return{name:e.name,version:e.version,install:e.install,dependencies:e.dependencies,...e.uninstall&&{uninstall:e.uninstall}}}const F=O({name:"LifecycleLogger",version:"1.0.0",install(e,t){t.globalProperties.set("$logLifecycle",!1!==t.options.enabled),e.logLifecycle=(e,n,s)=>{t.globalProperties.get("$logLifecycle")&&console.log(`[${e}] ${n}`,s||"")}}}),L=O({name:"FormValidation",version:"1.0.0",install(e,t){const n={name:"validate",bind(e,t){e.addEventListener("blur",()=>{const n=t.value;if("function"==typeof n){const t=n(e.value);e.classList.toggle("invalid",!t),e.classList.toggle("valid",t)}})}};t.directives.set("validate",n),e.validators={required:e=>!!e,email:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),minLength:e=>t=>t.length>=e,maxLength:e=>t=>t.length<=e,pattern:e=>t=>e.test(t)}}}),D=O({name:"I18n",version:"1.0.0",install(e,t){const n=t.options.messages||{};let s=t.options.locale||"ru";e.t=(e,t)=>{const r=n[s]?.[e]||e;return t?Object.keys(t).reduce((e,n)=>e.replace(new RegExp(`{${n}}`,"g"),t[n]),r):r},e.setLocale=e=>{s=e},e.getLocale=()=>s;const r={name:"i18n",bind(t,n){const s=n.value||t.textContent;s&&(t.textContent=e.t(s))},update(t,n){const s=n.value||n.expression;s&&(t.textContent=e.t(s))}};t.directives.set("i18n",r)}}),N=O({name:"Store",version:"1.0.0",install(e,t){const n=t.options.state||{},s=t.options.mutations||{},r=t.options.actions||{},o=e.reactive(n),i={state:o,commit(e,t){const n=s[e];n?n(o,t):console.warn(`Мутация "${e}" не найдена`)},dispatch(e,t){const n=r[e];if(n)return n({state:o,commit:this.commit,dispatch:this.dispatch},t);console.warn(`Действие "${e}" не найдено`)}};e.$store=i,t.globalProperties.set("$store",i)}});class V{constructor(){this.renderCache=new Map,this.performanceMetrics=new Map}static getInstance(){return V.instance||(V.instance=new V),V.instance}cacheRender(e,t,n){const s=this.generateCacheKey(e,t);this.renderCache.set(s,{result:n,timestamp:Date.now()}),this.cleanupCache()}getCachedRender(e,t){const n=this.generateCacheKey(e,t),s=this.renderCache.get(n);return s&&Date.now()-s.timestamp<5e3?s.result:null}measureRenderTime(e,t){const n=performance.now(),s=t(),r=performance.now();return this.recordMetric(e,r-n),s}getMetrics(){const e={};for(const[t,n]of this.performanceMetrics)e[t]={avg:n.reduce((e,t)=>e+t,0)/n.length,min:Math.min(...n),max:Math.max(...n),count:n.length};return e}generateCacheKey(e,t){return`${e}:${JSON.stringify(t)}`}recordMetric(e,t){this.performanceMetrics.has(e)||this.performanceMetrics.set(e,[]);const n=this.performanceMetrics.get(e);n.push(t),n.length>100&&n.shift()}cleanupCache(){const e=Date.now();for(const[t,n]of this.renderCache)e-n.timestamp>1e4&&this.renderCache.delete(t)}}class R{static batchUpdate(e){this.batchedUpdates.push(e),this.isScheduled||(this.isScheduled=!0,requestAnimationFrame(()=>{this.flushUpdates()}))}static flushUpdates(){const e=[...this.batchedUpdates];this.batchedUpdates.length=0,this.isScheduled=!1,e.forEach(e=>{try{e()}catch(t){console.error("Ошибка в батчированном обновлении:",t)}})}static createVirtualList(e,t,n){const s=Math.ceil(n/t)+2;let r=0;return{getVisibleItems(){const n=Math.floor(r/t),o=Math.min(n+s,e.length);return{items:e.slice(n,o),startIndex:n,endIndex:o,totalHeight:e.length*t,offsetY:n*t}},updateScrollTop(e){r=e}}}}R.batchedUpdates=[],R.isScheduled=!1;class U{static registerCleanup(e){this.cleanupFunctions.push(e)}static cleanup(){this.cleanupFunctions.forEach(e=>{try{e()}catch(t){console.error("Ошибка при очистке памяти:",t)}}),this.cleanupFunctions.length=0}static getMemoryUsage(){return"memory"in performance?performance.memory:null}static forceGC(){"gc"in window&&window.gc()}}U.cleanupFunctions=[];class _{static measure(e,t){const n=performance.now(),s=t(),r=performance.now();return this.recordTime(e,r-n),s}static recordTime(e,t){this.metrics.has(e)||this.metrics.set(e,[]);const n=this.metrics.get(e);n.push(t),n.length>1e3&&n.shift()}static getReport(){const e={};for(const[t,n]of this.metrics){const s=[...n].sort((e,t)=>e-t);e[t]={count:n.length,min:s[0],max:s[s.length-1],avg:n.reduce((e,t)=>e+t,0)/n.length,median:s[Math.floor(s.length/2)],p95:s[Math.floor(.95*s.length)],p99:s[Math.floor(.99*s.length)]}}return e}static clearMetrics(){this.metrics.clear()}}_.metrics=new Map;class Q{diff(e,t){const n=[];if(this.isDifferentType(e,t))return n.push({type:"REPLACE",oldConfig:e,newConfig:t}),{patches:n};const s=this.diffProps(e.props,t.props);s.length>0&&n.push({type:"PROPS",props:this.mergeProps(s)});const r=this.diffChildren(e.children||[],t.children||[]);return n.push(...r),{patches:n}}isDifferentType(e,t){return e.tag!==t.tag||e.component!==t.component}diffProps(e={},t={}){const n=[],s=new Set([...Object.keys(e),...Object.keys(t)]);for(const r of s){const s=e[r],o=t[r];r in e?r in t?this.isEqual(s,o)||n.push({key:r,type:"update",value:o}):n.push({key:r,type:"remove"}):n.push({key:r,type:"add",value:o})}return n}diffChildren(e,t){const n=[];if(this.hasKeys(e)||this.hasKeys(t))return this.diffChildrenWithKeys(e,t);const s=Math.max(e.length,t.length);for(let r=0;r<s;r++){const s=e[r],o=t[r];if(!s&&o)n.push({type:"ADD",index:r,newConfig:"string"==typeof o?void 0:o,text:"string"==typeof o?o:void 0});else if(s&&!o)n.push({type:"REMOVE",index:r});else if(s&&o)if("string"==typeof s&&"string"==typeof o)s!==o&&n.push({type:"TEXT_UPDATE",index:r,text:o});else if("object"==typeof s&&"object"==typeof o){const e=this.diff(s,o);e.patches.length>0&&n.push({type:"UPDATE",index:r,patches:e.patches})}else n.push({type:"REPLACE",index:r,oldConfig:"object"==typeof s?s:void 0,newConfig:"object"==typeof o?o:void 0,text:"string"==typeof o?o:void 0})}return n}diffChildrenWithKeys(e,t){const n=[],s=this.createKeyMap(e);this.createKeyMap(t);const r=new Set,o=new Set;return t.forEach((t,i)=>{const a=this.getKey(t,i),c=s.get(a);if(void 0!==c){const s=e[c];if(r.add(c),o.add(i),c!==i&&n.push({type:"MOVE",index:c,newIndex:i}),"object"==typeof s&&"object"==typeof t){const e=this.diff(s,t);e.patches.length>0&&n.push({type:"UPDATE",index:i,patches:e.patches})}}else n.push({type:"ADD",index:i,newConfig:"object"==typeof t?t:void 0,text:"string"==typeof t?t:void 0})}),e.forEach((e,t)=>{r.has(t)||n.push({type:"REMOVE",index:t})}),n}createKeyMap(e){const t=new Map;return e.forEach((e,n)=>{const s=this.getKey(e,n);t.set(s,n)}),t}getKey(e,t){return"object"==typeof e&&void 0!==e.key?e.key:t}hasKeys(e){return e.some(e=>"object"==typeof e&&void 0!==e.key)}mergeProps(e){const t={};return e.forEach(e=>{"remove"===e.type?t[e.key]=null:t[e.key]=e.value}),t}isEqual(e,t){return e===t||(null==e||null==t?e===t:typeof e==typeof t&&("object"==typeof e&&JSON.stringify(e)===JSON.stringify(t)))}}class z{patch(e,t){let n=e;return t.forEach(e=>{n=this.applyPatch(n,e)}),n}applyPatch(e,t){switch(t.type){case"REPLACE":return this.replacePatch(e,t);case"PROPS":this.propsPatch(e,t);break;case"ADD":this.addPatch(e,t);break;case"REMOVE":this.removePatch(e,t);break;case"UPDATE":this.updatePatch(e,t);break;case"TEXT_UPDATE":this.textUpdatePatch(e,t);break;case"MOVE":this.movePatch(e,t)}return e}replacePatch(e,t){if(!t.newConfig)throw new Error("Новая конфигурация требуется для замены");return console.warn("Замена элемента еще не реализована"),e}propsPatch(e,t){t.props&&Object.entries(t.props).forEach(([t,n])=>{null===n?e.removeAttribute(t):"style"===t&&"object"==typeof n?this.updateStyles(e,n):"class"===t?e.className=n:e.setAttribute(t,String(n))})}addPatch(e,t){const n=t.index||e.children.length;if(void 0!==t.text){const s=document.createTextNode(t.text);n>=e.children.length?e.appendChild(s):e.insertBefore(s,e.children[n])}else t.newConfig&&console.warn("Добавление элемента из конфигурации еще не реализовано")}removePatch(e,t){const n=t.index;if(void 0!==n&&n<e.children.length){const t=e.children[n];e.removeChild(t)}}updatePatch(e,t){const n=t.index;if(void 0!==n&&n<e.children.length&&t.patches){const s=e.children[n];this.patch(s,t.patches)}}textUpdatePatch(e,t){const n=t.index;if(void 0!==n&&void 0!==t.text){const s=e.childNodes[n];s&&s.nodeType===Node.TEXT_NODE&&(s.textContent=t.text)}}movePatch(e,t){const n=t.index,s=t.newIndex;if(void 0!==n&&void 0!==s){const t=e.children[n],r=e.children[s];t&&(r?e.insertBefore(t,r):e.appendChild(t))}}updateStyles(e,t){Object.entries(t).forEach(([t,n])=>{null==n?e.style.removeProperty(t):e.style.setProperty(t,String(n))})}}const B=new Q,H=new z;function K(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}class q{constructor(e){this.renderer=new k,this.validator=new t,this.mountedElement=null,this.globalState=a({}),this.pluginManager=new j(this)}registerComponent(e){f(e)}reactive(e){return a(e)}getGlobalState(){return this.globalState}nextTick(){return g()}computed(e){return I(e)}use(e,t){return this.pluginManager.use(e,t),this}directive(e){return this.pluginManager.registerDirective(e),this}config(e,t){return this.pluginManager.addGlobalProperty(e,t),this}getInstalledPlugins(){return this.pluginManager.getInstalledPlugins()}render(e,t){const n="string"==typeof t?document.querySelector(t):t;if(!n)throw new Error("Контейнер не найден");const s=this.validator.validate(e);if(!s.isValid){const e=s.errors.map(e=>e.message).join(", ");throw new Error(`Ошибка валидации: ${e}`)}this.mountedElement&&this.unmount();const r=this.renderer.render(e,n);return this.mountedElement=r,r}unmount(){this.mountedElement&&(this.renderer.unmount(this.mountedElement),this.mountedElement=null)}update(e){if(!this.mountedElement)throw new Error("Нет смонтированного элемента для обновления");const t=this.validator.validate(e);if(!t.isValid){const e=t.errors.map(e=>e.message).join(", ");throw new Error(`Ошибка валидации: ${e}`)}const n=this.renderer.updateElement(this.mountedElement,e);return this.mountedElement=n,n}getStats(){return this.renderer.getStats()}findById(e){return this.mountedElement?this.renderer.findElementById(this.mountedElement,e):null}findByClass(e){return this.mountedElement?this.renderer.findElementsByClass(this.mountedElement,e):[]}cleanup(){this.unmount(),this.renderer.cleanup(),this.validator.reset(),this.pluginManager.cleanup()}getMountedElement(){return this.mountedElement}}const J=new q;return e.ComponentOptimizer=V,e.ComponentRenderer=k,e.ConfigValidator=t,e.DOMDiffer=Q,e.DOMOptimizer=R,e.DOMPatcher=z,e.ForDirective=C,e.FormValidationPlugin=L,e.Framework=J,e.HTMLRenderer=class{constructor(e={}){this.eventListeners=new Map,this.options={enableValidation:!0,enableLogging:!1,...e},this.stats={elementsCreated:0,eventsAttached:0,renderTime:0}}render(e,t){const n=performance.now();try{const s=this.createElement(e);return t.appendChild(s),this.stats.renderTime=performance.now()-n,this.options.enableLogging&&console.log(`Рендеринг завершен за ${this.stats.renderTime.toFixed(2)}мс`),s}catch(s){throw console.error("Ошибка рендеринга:",s),s}}createElement(e){const t=e.tag||"div",n=document.createElement(t);return this.stats.elementsCreated++,e.props&&this.applyProps(n,e.props),e.events&&this.attachEvents(n,e.events),e.children&&this.renderChildren(n,e.children),n}applyProps(e,t){for(const[n,s]of Object.entries(t))switch(n){case"class":e.className=s;break;case"id":e.id=s;break;case"style":this.applyStyles(e,s);break;default:null!=s&&e.setAttribute(n,String(s))}}applyStyles(e,t){for(const[n,s]of Object.entries(t))if(null!=s){const t=n.replace(/([A-Z])/g,"-$1").toLowerCase();e.style.setProperty(t,String(s))}}attachEvents(e,t){const n=[];for(const[s,r]of Object.entries(t)){if(!r)continue;if("mounted"===s||"unmounted"===s)continue;const t={type:s,handler:r,element:e};e.addEventListener(s,r),n.push(t),this.stats.eventsAttached++}n.length>0&&this.eventListeners.set(e,n)}renderChildren(e,t){t.forEach(t=>{if("string"==typeof t){const n=document.createTextNode(t);e.appendChild(n)}else if(t&&"object"==typeof t&&t.tag){const n=this.createElement(t);e.appendChild(n)}else console.warn("Некорректный дочерний элемент:",t)})}unmount(e){this.cleanupEventListeners(e);Array.from(e.children).forEach(e=>{e instanceof HTMLElement&&this.unmount(e)}),e.parentNode&&e.parentNode.removeChild(e)}cleanupEventListeners(e){const t=this.eventListeners.get(e);t&&(t.forEach(({type:t,handler:n})=>{e.removeEventListener(t,n)}),this.eventListeners.delete(e))}update(e,t){const n=e.parentNode;if(!n)throw new Error("Элемент не имеет родителя для обновления");const s=this.createElement(t);return n.replaceChild(s,e),this.unmount(e),s}getStats(){return{...this.stats}}resetStats(){this.stats={elementsCreated:0,eventsAttached:0,renderTime:0}}getEventListenersCount(){let e=0;return this.eventListeners.forEach(t=>{e+=t.length}),e}createRenderContext(e,t,n){return{element:e,config:t,...n&&{parentContext:n}}}findElementById(e,t){if(e.id===t)return e;for(const n of Array.from(e.children))if(n instanceof HTMLElement){const e=this.findElementById(n,t);if(e)return e}return null}findElementsByClass(e,t){const n=[];e.classList.contains(t)&&n.push(e);for(const s of Array.from(e.children))s instanceof HTMLElement&&n.push(...this.findElementsByClass(s,t));return n}cleanup(){this.eventListeners.forEach((e,t)=>{e.forEach(({type:e,handler:n})=>{t.removeEventListener(e,n)})}),this.eventListeners.clear(),this.resetStats()}},e.I18nPlugin=D,e.IfDirective=P,e.JSFramework=q,e.LifecycleLoggerPlugin=F,e.MemoryManager=U,e.ModelDirective=M,e.PerformanceAnalyzer=_,e.PluginManager=j,e.PriorityScheduler=w,e.ShowDirective=x,e.StorePlugin=N,e.camelToKebab=K,e.cloneConfig=function(e){return JSON.parse(JSON.stringify(e))},e.combineClasses=function(...e){return e.filter(Boolean).join(" ")},e.componentRegistry=d,e.computed=I,e.computedManager=A,e.createComponentComputed=function(e,t){const n=I(e);return A.register(n),{get value(){return n.value},get dirty(){return n.dirty},get effect(){return n.effect},destroy(){A.unregister(n),t&&t()}}},e.createComponentInstance=function(e,t){return d.createInstance(e,t)},e.createElement=function(e,t,n){const s={tag:e,props:t};return void 0!==n&&(s.children=n),s},e.createReactive=a,e.createTextNode=function(e){return String(e)},e.debounce=function(e,t){let n;return(...s)=>{clearTimeout(n),n=setTimeout(()=>e(...s),t)}},e.default=J,e.definePlugin=O,e.directiveManager=T,e.domDiffer=B,e.domPatcher=H,e.effect=h,e.enableTracking=function(){l=!0},e.escapeHtml=function(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML},e.flushSync=y,e.getComponent=function(e){return d.get(e)},e.isComputedRef=function(e){return!(!e||!e._effect||void 0===e.value)},e.isElementConfig=function(e){return e&&"object"==typeof e&&"string"==typeof e.tag},e.isReactive=function(e){return i.has(e)},e.isValidHtmlTag=function(e){return["div","span","p","h1","h2","h3","h4","h5","h6","button","input","form","label","textarea","select","option","a","img","ul","ol","li","table","tr","td","th","header","footer","main","section","article","nav","strong","em","small","br","hr"].includes(e.toLowerCase())},e.memo=function(e,t){let n,s=[],r=!1;return()=>((!r||t.some((e,t)=>e!==s[t]))&&(n=e(),s=[...t],r=!0),n)},e.memoize=function(e,t){const n=new Map;return(...s)=>{const r=t?t(...s):JSON.stringify(s);if(n.has(r))return n.get(r);const o=e(...s);if(n.set(r,o),n.size>1e3){const e=n.keys().next().value;n.delete(e)}return o}},e.nextTick=g,e.pauseTracking=function(){l=!1},e.registerComponent=f,e.scheduleUpdate=v,e.scheduler=m,e.shallowReactive=function(e){return a(e,{deep:!1})},e.stop=p,e.stylesToString=function(e){return Object.entries(e).map(([e,t])=>`${K(e)}: ${t}`).join("; ")},e.throttle=function(e,t){let n;return(...s)=>{n||(e(...s),n=!0,setTimeout(()=>n=!1,t))}},e.toRaw=function(e){const t=i.get(e);return t||e},e.useComputed=function(e,t){const n=I(e);return A.register(n),n},Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}}),e}({});
//# sourceMappingURL=js-framework.iife.js.map
